<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jærligaen i Bordhockey – Sesongresultater</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #1e40af;
      --primary-600:#1e3a8a;
      --bg:#0f172a;
      --panel:#ffffff;
      --muted:#6b7280;
      --accent:#f59e0b;
      --border:#e5e7eb;
      --good:#10b981;
      --warn:#f59e0b;
      --bad:#ef4444;
      --radius:12px;
    }
    * { box-sizing:border-box; }
    body {
      margin:0; font-family:Inter, system-ui, sans-serif; background:linear-gradient(135deg,#667eea,#764ba2);
      color:#0f172a; min-height:100vh;
    }
    .wrap { max-width:1400px; margin:0 auto; padding:24px; }
    h1 { color:#fff; text-align:center; margin:8px 0 2px; font-weight:800 }
    .sub { color:#fff; text-align:center; opacity:.9; margin-bottom:8px }
    .season-nav { text-align:center; margin-bottom:16px; color:#fff; }
    .season-nav a { color:#fff; margin:0 4px; }
    .toolbar {
      display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:center; margin:16px 0 20px;
    }
    .toolbar input[type="search"] {
      padding:10px 12px; border:1px solid var(--border); border-radius:10px; min-width:280px;
    }
    .btn {
      border:1px solid var(--border); background:#fff; padding:10px 14px; border-radius:10px; cursor:pointer;
      font-weight:600;
    }
    .btn.primary { background:var(--primary); color:#fff; border-color:var(--primary-600); }
    .cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin:14px 0 22px; }
    .card {
      background:#fff; border:1px solid var(--border); border-radius:var(--radius); padding:14px; text-align:center;
      box-shadow: 0 8px 20px rgba(0,0,0,.06);
    }
    .card h3 { margin:0; color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.06em }
    .val { font-size:26px; font-weight:800; margin-top:6px; color:var(--primary) }

    .tablebox { background:#fff; border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; }
    .scroll { overflow:auto; }
    table { border-collapse:collapse; width:100%; font-size:14px; }
    thead th {
      position:sticky; top:0; background:#f8fafc; border-bottom:2px solid var(--border);
      padding:10px; text-align:center; white-space:nowrap; cursor:pointer; user-select:none;
    }
    th:first-child, td:first-child {
      position:sticky; left:0; z-index:2; background:#fff; border-right:1px solid var(--border);
      text-align:left;
    }
    th:nth-child(2), td:nth-child(2) { text-align:left; }
    tbody td { border-bottom:1px solid var(--border); padding:10px; text-align:center; white-space:nowrap; }
    tbody tr:hover { background:#f3f4f6; }
    .rank { font-weight:800; color:#111827; }
    .name { font-weight:600; color:#111827; }
    .topp17 { font-weight:800; color:var(--accent); background:#fff7ed; }
    .chip { background:#f1f5f9; border:1px solid var(--border); padding:2px 8px; border-radius:999px; font-size:12px; }
    .collapsed th.league, .collapsed td.league { display:none; }
    /* score color cues */
    td[data-score="100"]{ background:rgba(16,185,129,.10); font-weight:800; color:var(--good); }
    td[data-score="85"] { background:rgba(16,185,129,.08); color:var(--good); font-weight:700; }
    td[data-score="75"] { background:rgba(16,185,129,.06); color:var(--good); font-weight:700; }
    td[data-score="65"],td[data-score="60"],td[data-score="55"],td[data-score="50"]{ color:var(--warn); font-weight:700; }
    td[data-score="0"]  { color:var(--bad); opacity:.9; }
    .th-meta { display:block; font-size:11px; color:#475569; font-weight:600; }
    .th-meta a{ color:inherit; text-decoration:none; border-bottom:1px dashed #94a3b8; }
    .th-meta small{ font-weight:500; color:#64748b }
    .foot { color:#fff; text-align:center; margin-top:18px; opacity:.9 }
    @media (max-width: 860px) {
      .btn, input[type="search"] { width:100%; max-width:520px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Jærligaen i Bordhockey</h1>
    <div class="sub">Sesong 2025/2026 – topp 17 teller</div>
    <div class="season-nav"><strong>2025/2026</strong></div>

    <div class="cards" id="stats">
      <div class="card"><h3>Antall spillere</h3><div class="val" id="stat_players">-</div></div>
      <div class="card"><h3>Antall ligaer</h3><div class="val" id="stat_leagues">-</div></div>
      <div class="card"><h3>Maks antall deltakere</h3><div class="val" id="stat_maxpart">-</div></div>
      <div class="card"><h3>Snitt antall pr. liga</h3><div class="val" id="stat_avgpart">-</div></div>
    </div>

    <div class="toolbar">
      <input id="search" type="search" placeholder="Søk spiller … (f.eks. 'Nygård')" />
      <button id="toggle" class="btn">Vis alle ligaer</button>
      <button id="exportCsv" class="btn primary">Last ned CSV</button>
    </div>

    <div class="tablebox">
      <div class="scroll">
        <table id="tbl" class="collapsed">
          <thead>
            <tr>
              <th data-key="Rank" aria-sort="descending">#</th>
              <th data-key="Spiller">Spiller</th>
              <th data-key="Topp 17">Topp 17</th>
              <th data-key="Tellende">Tellende</th>
              <th data-key="Spilt">Spilt</th>
              <th data-key="Snitt">Snitt</th>
              <th data-key="Seire">Seire</th>
              <th data-key="Podier">Podier</th>
              <th class="league" data-key="#1" title="Vinner: Amund Risa Fylling (100)">#1<span class="th-meta"><a href="https://stiga.trefik.cz/ithf/ranking/tournament.aspx?id=34869" target="_blank" rel="noopener">Jarliga 2025/26 #1</a> · 06.08 · <small>11 spillere</small></span></th>
              <th class="league" data-key="#2" title="Vinner: Amund Risa Fylling (100)">#2<span class="th-meta"><a href="https://stiga.trefik.cz/ithf/ranking/tournament.aspx?id=34870" target="_blank" rel="noopener">Jarliga 2025/26 #2</a> · 13.08 · <small>11 spillere</small></span></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="rank">1</td>
              <td class="name" data-name="amund risa fylling">Amund Risa Fylling</td>
              <td class="topp17">200</td>
              <td><span class="chip">2</span></td>
              <td>2</td>
              <td>100.00</td>
              <td>2</td>
              <td>2</td>
              <td class="league" data-score="100">100</td>
              <td class="league" data-score="100">100</td>
            </tr>
            <tr>
              <td class="rank">2</td>
              <td class="name" data-name="benjamin nygard">Benjamin Nygard</td>
              <td class="topp17">140</td>
              <td><span class="chip">2</span></td>
              <td>2</td>
              <td>70.00</td>
              <td>0</td>
              <td>1</td>
              <td class="league" data-score="55">55</td>
              <td class="league" data-score="85">85</td>
            </tr>
            <tr>
              <td class="rank">3</td>
              <td class="name" data-name="sinus moberg">Sinus Moberg</td>
              <td class="topp17">125</td>
              <td><span class="chip">2</span></td>
              <td>2</td>
              <td>62.50</td>
              <td>0</td>
              <td>0</td>
              <td class="league" data-score="60">60</td>
              <td class="league" data-score="65">65</td>
            </tr>
            <tr>
              <td class="rank">4</td>
              <td class="name" data-name="kjartan moberg">Kjartan Moberg</td>
              <td class="topp17">102</td>
              <td><span class="chip">2</span></td>
              <td>2</td>
              <td>51.00</td>
              <td>0</td>
              <td>0</td>
              <td class="league" data-score="42">42</td>
              <td class="league" data-score="60">60</td>
            </tr>
            <tr>
              <td class="rank">5</td>
              <td class="name" data-name="stine moberg">Stine Moberg</td>
              <td class="topp17">101</td>
              <td><span class="chip">2</span></td>
              <td>2</td>
              <td>50.50</td>
              <td>0</td>
              <td>0</td>
              <td class="league" data-score="46">46</td>
              <td class="league" data-score="55">55</td>
            </tr>
            <tr>
              <td class="rank">6</td>
              <td class="name" data-name="sille moberg">Sille Moberg</td>
              <td class="topp17">92</td>
              <td><span class="chip">2</span></td>
              <td>2</td>
              <td>46.00</td>
              <td>0</td>
              <td>0</td>
              <td class="league" data-score="44">44</td>
              <td class="league" data-score="48">48</td>
            </tr>
            <tr>
              <td class="rank">7</td>
              <td class="name" data-name="magnus klippen">Magnus Klippen</td>
              <td class="topp17">85</td>
              <td><span class="chip">1</span></td>
              <td>1</td>
              <td>85.00</td>
              <td>0</td>
              <td>1</td>
              <td class="league" data-score="85">85</td>
              <td class="league" data-score="0">0</td>
            </tr>
            <tr>
              <td class="rank">8</td>
              <td class="name" data-name="daniel nygard">Daniel Nygard</td>
              <td class="topp17">75</td>
              <td><span class="chip">1</span></td>
              <td>1</td>
              <td>75.00</td>
              <td>0</td>
              <td>1</td>
              <td class="league" data-score="75">75</td>
              <td class="league" data-score="0">0</td>
            </tr>
            <tr>
              <td class="rank">9</td>
              <td class="name" data-name="andreas fjermestad">Andreas Fjermestad</td>
              <td class="topp17">75</td>
              <td><span class="chip">1</span></td>
              <td>1</td>
              <td>75.00</td>
              <td>0</td>
              <td>1</td>
              <td class="league" data-score="0">0</td>
              <td class="league" data-score="75">75</td>
            </tr>
            <tr>
              <td class="rank">10</td>
              <td class="name" data-name="arne hetlelid">Arne Hetlelid</td>
              <td class="topp17">65</td>
              <td><span class="chip">1</span></td>
              <td>1</td>
              <td>65.00</td>
              <td>0</td>
              <td>0</td>
              <td class="league" data-score="65">65</td>
              <td class="league" data-score="0">0</td>
            </tr>
            <tr>
              <td class="rank">11</td>
              <td class="name" data-name="ane skadsem">Ane Skadsem</td>
              <td class="topp17">50</td>
              <td><span class="chip">1</span></td>
              <td>1</td>
              <td>50.00</td>
              <td>0</td>
              <td>0</td>
              <td class="league" data-score="50">50</td>
              <td class="league" data-score="0">0</td>
            </tr>
            <tr>
              <td class="rank">12</td>
              <td class="name" data-name="nicolas trae">Nicolas Trae</td>
              <td class="topp17">50</td>
              <td><span class="chip">1</span></td>
              <td>1</td>
              <td>50.00</td>
              <td>0</td>
              <td>0</td>
              <td class="league" data-score="0">0</td>
              <td class="league" data-score="50">50</td>
            </tr>
            <tr>
              <td class="rank">13</td>
              <td class="name" data-name="rikard oddane">Rikard Oddane</td>
              <td class="topp17">48</td>
              <td><span class="chip">1</span></td>
              <td>1</td>
              <td>48.00</td>
              <td>0</td>
              <td>0</td>
              <td class="league" data-score="48">48</td>
              <td class="league" data-score="0">0</td>
            </tr>
            <tr>
              <td class="rank">14</td>
              <td class="name" data-name="ruben nesse haland">Ruben Nesse Haland</td>
              <td class="topp17">46</td>
              <td><span class="chip">1</span></td>
              <td>1</td>
              <td>46.00</td>
              <td>0</td>
              <td>0</td>
              <td class="league" data-score="0">0</td>
              <td class="league" data-score="46">46</td>
            </tr>
            <tr>
              <td class="rank">15</td>
              <td class="name" data-name="theodor fuglestad">Theodor Fuglestad</td>
              <td class="topp17">44</td>
              <td><span class="chip">1</span></td>
              <td>1</td>
              <td>44.00</td>
              <td>0</td>
              <td>0</td>
              <td class="league" data-score="0">0</td>
              <td class="league" data-score="44">44</td>
            </tr>
            <tr>
              <td class="rank">16</td>
              <td class="name" data-name="aslaug olina narland">Aslaug Olina Narland</td>
              <td class="topp17">42</td>
              <td><span class="chip">1</span></td>
              <td>1</td>
              <td>42.00</td>
              <td>0</td>
              <td>0</td>
              <td class="league" data-score="0">0</td>
              <td class="league" data-score="42">42</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="foot">
      Generert: 25.08.2025 21:55 · Jærligaen i Bordhockey
    </div>
  </div>

  <!-- Data payload for utilities -->
  <script type="application/json" id="payload">{"columns": ["Spiller", "Rank", "Topp 17", "Tellende", "Spilt", "Snitt", "Seire", "Podier", "#1", "#2"], "tournaments": [{"key": "#1", "name": "Jarliga 2025/26 #1", "date": "2025-08-06", "url": "https://stiga.trefik.cz/ithf/ranking/tournament.aspx?id=34869", "participants": 11, "winner": "Amund Risa Fylling", "winner_points": 100}, {"key": "#2", "name": "Jarliga 2025/26 #2", "date": "2025-08-13", "url": "https://stiga.trefik.cz/ithf/ranking/tournament.aspx?id=34870", "participants": 11, "winner": "Amund Risa Fylling", "winner_points": 100}], "generated_at": "2025-08-25T21:55:54", "top_n": 17}</script>

  <script>
    // --------------------- Utilities ---------------------
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const tbl = $("#tbl");
    const search = $("#search");
    const toggleBtn = $("#toggle");
    const exportBtn = $("#exportCsv");
    const payload = JSON.parse($("#payload").textContent);

    // Stats: players, leagues, max/avg participants
    (function initStats(){
      const players = $$("#tbl tbody tr").length;
      const leagues = $$("#tbl thead th.league").length;
      const parts = payload.tournaments.map(t => t.participants || 0);
      const maxp = parts.length ? Math.max(...parts) : 0;
      const avgp = parts.length ? Math.round(parts.reduce((a,b)=>a+b,0)/parts.length) : 0;
      $("#stat_players").textContent = players;
      $("#stat_leagues").textContent = leagues;
      $("#stat_maxpart").textContent = maxp;
      $("#stat_avgpart").textContent = avgp;
    })();

    // Search by player name (case-insensitive)
    search.addEventListener("input", e => {
      const q = e.target.value.trim().toLowerCase();
      $$("#tbl tbody tr").forEach(tr => {
        const name = tr.querySelector("td.name")?.dataset.name || "";
        tr.style.display = (!q || name.includes(q)) ? "" : "none";
      });
    });

    // Toggle all league columns
    toggleBtn.addEventListener("click", () => {
      tbl.classList.toggle("collapsed");
      toggleBtn.textContent = tbl.classList.contains("collapsed") ? "Vis alle ligaer" : "Skjul ligaer";
    });

    // Simple click-to-sort for any header
    let sortState = { key: "Topp 17", dir: "desc" };
    function getCellValue(tr, idx) {
      const td = tr.children[idx];
      if (!td) return "";
      const raw = td.textContent.trim();
      const num = Number(raw.replace(",", "."));
      return isNaN(num) ? raw : num;
    }
    function sortByTH(th) {
      const ths = $$("#tbl thead th");
      const idx = ths.indexOf ? ths.indexOf(th) : ths.findIndex(x => x===th);
      const key = th.dataset.key || "";
      const dir = (sortState.key===key && sortState.dir==="asc") ? "desc" : "asc";
      sortState = { key, dir };

      const rows = $$("#tbl tbody tr");
      rows.sort((a,b) => {
        const va = getCellValue(a, idx);
        const vb = getCellValue(b, idx);
        if (typeof va === "number" && typeof vb === "number") {
          return dir==="asc" ? va - vb : vb - va;
        } else {
          return dir==="asc" ? String(va).localeCompare(String(vb)) : String(vb).localeCompare(String(va));
        }
      });
      const tbody = $("#tbl tbody");
      rows.forEach(r => tbody.appendChild(r));
      // aria-sort
      ths.forEach(h => h.setAttribute("aria-sort","none"));
      th.setAttribute("aria-sort", dir==="asc" ? "ascending" : "descending");
    }
    $$("#tbl thead th").forEach(th => {
      th.addEventListener("click", () => sortByTH(th));
    });

    // CSV export (entire current table)
    function tableToCSV() {
      const rows = $$("#tbl tr");
      return rows.map(tr => {
        const cells = Array.from(tr.children).filter(td => td.style.display!=="none");
        return cells.map(td => {
          let t = td.textContent.replaceAll("\n"," ").trim();
          if (t.includes('"') || t.includes(","))
            t = '"' + t.replaceAll('"','""') + '"';
          return t;
        }).join(",");
      }).join("\n");
    }
    exportBtn.addEventListener("click", () => {
      const csv = tableToCSV();
      const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "jarliga_resultater.csv";
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>